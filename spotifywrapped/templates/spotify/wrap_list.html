{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile</title>
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
</head>
<body class="flex-column">
    <div class="contentWrapper">
        <nav class="navbar">
            <img class="logo" src="{% static 'css/logo.png' %}" alt="Spotify Wrapped Logo"/>
            <a class="home" href="{% url 'index' %}">Home</a>
            <a class="contact" href="{% url 'contact' %}">Contact the Developers</a>
            <a class="profile" href="{% url 'wrap_list' %}">
              <img src="{% static 'images/defaultpfp.png' %}" alt="Spotify Wrapped Logo" width="50"/>
            </a> 
          </nav>
    </div>
    <a href="{% url 'delete_all_wraps' %}" class="btn btn-danger">Delete All Wraps</a>
    <a href="{% url 'logout' %}">Logout</a>
    <div class="carousel">
        <div class="carousel-inner">
            {% for wrap in wraps %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <!-- Caption (Visible for active item only) -->
                    <div class="carousel-caption {% if forloop.first %}show{% endif %}">
                        <h1>YOUR SPOTIFY WRAPPED</h1>
                        <h3>
                            {{wrap.title}}
                        </h3>
    
                        <!-- Display Top Artists (Only top 5) -->
                        <div class="wrap-details">
                            <p><strong>Top Artists:</strong></p>
                            <ul>
                                {% for artist_data in wrap.top_artists|slice:":5" %}
                                    {% for artist in artist_data.album.artists %}
                                    <ul>{{ artist.name }}</ul>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        <p><strong>Top Songs:</strong></p>
                        <ul>
                            {% for track in wrap.wrap_data.items|slice:":5" %}
                                <ul>{{ track.name }}</ul>
                            {% empty %}
                                <ul>No top songs available.</ul>
                            {% endfor %}
                        </ul>
                    </div>
                    <p>Generated on: {{ wrap.created_at }}</p>
                </div>
                    
    

                </div>
            {% endfor %}
        </div>
        <!-- Carousel Navigation Buttons -->
        <button class="carousel-control prev" onclick="prevSlide()">❮</button>
        <button class="carousel-control next" onclick="nextSlide()">❯</button>
    </div>
    
    
    

    <script>
        let currentIndex = 0;

    function showSlide(index) {
    const slides = document.querySelectorAll('.carousel-item');
    const captions = document.querySelectorAll('.carousel-caption');
    const details = document.querySelectorAll('.wrap-details');
    const totalSlides = slides.length;

    // Update currentIndex with bounds check
    currentIndex = (index + totalSlides) % totalSlides;

    // Update slides
    slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === currentIndex);
    });

    // Update captions and top artists details
    captions.forEach((caption, i) => {
        caption.classList.toggle('show', i === currentIndex);
    });

    details.forEach((detail, i) => {
        detail.classList.toggle('show', i === currentIndex);  // Show wrap details (Top Artists) for active slide
    });
}

// Functions for navigation
function prevSlide() {
    showSlide(currentIndex - 1);
}

function nextSlide() {
    showSlide(currentIndex + 1);
}

// Initialize the carousel
function initCarousel() {
    showSlide(currentIndex);  // Show the first slide
}

// Initialize
initCarousel();

</script>
</body>
</html>